<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>YRN Generator</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        /* Keeping your luxury styling */
        :root { --gold: #c5a059; --paper: #fdf8e4; }
        body { background: #222; color: #eee; font-family: sans-serif; display: flex; margin: 0; height: 100vh; }
        .sidebar { width: 350px; padding: 20px; background: #111; border-right: 1px solid #444; overflow-y: auto; }
        input { width: 100%; padding: 10px; margin: 10px 0; background: #222; border: 1px solid #444; color: white; }
        .preview { flex: 1; display: flex; justify-content: center; align-items: center; background: #444; }
        #receipt { width: 150mm; height: 200mm; background: var(--paper); color: #1a1a1a; padding: 40px; position: relative; }
        #qrcode { position: absolute; bottom: 40px; right: 40px; background: white; padding: 5px; }
        .status { font-size: 0.7rem; color: var(--gold); }
    </style>
</head>
<body>
    <div class="sidebar">
        <h2>YRN Generator</h2>
        <div class="status" id="conn-status">Status: Disconnected</div>
        
        <label>1. Create a Room Name (e.g. yrn01)</label>
        <input type="text" id="room-id" value="yrn-luxury" oninput="initConnection()">
        
        <label>Customer Name</label>
        <input type="text" id="i-name" value="Emeka Okafor" oninput="sendData()">
        
        <label>Product</label>
        <input type="text" id="i-item" value="Diamond Link" oninput="sendData()">
        
        <label>Price</label>
        <input type="text" id="i-price" value="â‚¦3,000,000" oninput="sendData()">
    </div>

    <div class="preview">
        <div id="receipt">
            <h1>YRN THE JEWELLER</h1>
            <hr>
            <p>Customer: <strong id="o-name">...</strong></p>
            <p>Item: <strong id="o-item">...</strong></p>
            <p>Total: <strong id="o-price">...</strong></p>
            <div id="qrcode"></div>
        </div>
    </div>

    <script>
        let peer = null;
        let conn = null;
        let qr = new QRCode(document.getElementById("qrcode"), { width: 80, height: 80 });

        function initConnection() {
            const roomName = document.getElementById('room-id').value;
            if (peer) peer.destroy();
            
            // Connect to the Peer network
            peer = new Peer(roomName + "-host"); 
            
            peer.on('open', () => {
                document.getElementById('conn-status').innerText = "Status: Online (Room: " + roomName + ")";
                updateQR();
            });

            peer.on('connection', (c) => {
                conn = c;
                document.getElementById('conn-status').innerText = "Status: Phone Connected!";
                sendData(); // Send initial data
            });
        }

        function updateQR() {
            const roomName = document.getElementById('room-id').value;
            const url = `https://hannas04.github.io/yrn-receipt/display.html?room=${roomName}`;
            qr.makeCode(url);
        }

        function sendData() {
            const data = {
                name: document.getElementById('i-name').value,
                item: document.getElementById('i-item').value,
                price: document.getElementById('i-price').value
            };
            
            // Update local preview
            document.getElementById('o-name').innerText = data.name;
            document.getElementById('o-item').innerText = data.item;
            document.getElementById('o-price').innerText = data.price;

            // Send to phone if connected
            if (conn && conn.open) {
                conn.send(data);
            }
        }

        // Start immediately
        initConnection();
    </script>
</body>
</html>